<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="es"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <title>INKALOTO - Historial de movimientos</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link href="css/style.css" rel="stylesheet" type="text/css"/>
</h:head>

<h:body>

<!-- =============== TOPBAR =============== -->
<header class="topbar">
    <div class="container nav-slim">
        <!-- Logo / inicio -->
        <a href="#{request.contextPath}/index.xhtml" class="brand">INKALOTO</a>

        <div class="nav-slim-right">
            <!-- ðŸ”” ahora puedes usar el total de no leÃ­das en ESTA pÃ¡gina -->
            <a href="#{request.contextPath}/notificaciones.xhtml"
                class="notif-icon"
                title="Notificaciones">
                 ðŸ””
                 <span id="notifCount" class="notif-badge">
                     #{notificacionesBean.cantidadNoLeidas}
                 </span>
             </a>

            <!-- Cargar saldo -->
            <a href="#{request.contextPath}/cargarsaldo.xhtml" class="btn btn-dark pill">+ Cargar saldo</a>

            <!-- Saldo -->
            <span class="balance-mini">
                S/
                <strong>
                    <h:outputText value="#{miCuentaBean.billetera.saldoActual}">
                        <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>
                    </h:outputText>
                </strong>
            </span>

            <!-- MenÃº de usuario -->
            <div class="select user-select">
                <select id="userMenu" onchange="cambiarPagina(this)">
                    <option value="">
                        #{loginBean.usuarioLogueado != null ? loginBean.usuarioLogueado.nombres : 'Usuario'}
                    </option>
                    <option value="#{request.contextPath}/micuenta.xhtml">Mi cuenta</option>
                    <option value="#{request.contextPath}/historialtransacciones.xhtml">Movimientos</option>
                    <option value="#{request.contextPath}/historialjugada.xhtml">Historial de jugadas</option>
                    <option value="#{request.contextPath}/historialpremios.xhtml">Premios</option>
                    <option value="#{request.contextPath}/notificaciones.xhtml">Notificaciones</option>
                    <option value="#{request.contextPath}/retiro.xhtml">Retirar premios</option>
                </select>
            </div>
                                    <!-- Cerrar sesiÃ³n -->
                                    <h:form style="display:inline;">
                    <h:commandButton value="Cerrar sesiÃ³n"
                                     action="#{loginBean.logout}"
                                     styleClass="btn-logout" />
                </h:form>
        </div>
    </div>
</header>


<!-- =============== CONTENIDO =============== -->
<main class="panel">
    <div class="panel-inner">

        <h1>Historial de <span class="accent">movimientos</span></h1>
        <p class="hint">
            AquÃ­ se muestran las recargas y retiros registrados en tu billetera INKALOTO.
        </p>

        <!-- Cajita con saldo actual -->
        <div class="info-box">
            <p>Saldo disponible:
                <strong>
                    S/
                    <h:outputText value="#{miCuentaBean.billetera.saldoActual}">
                        <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>
                    </h:outputText>
                </strong>
            </p>
        </div>

        <h:form>

            <!-- Si no hay movimientos -->
            <h:panelGroup rendered="#{empty historialTransaccionesBean.movimientos}">
                <div style="text-align:center; padding:40px; color:#777;">
                    <h3>AÃºn no tienes movimientos registrados</h3>
                    <p>Cuando recargues saldo o realices retiros, aparecerÃ¡n aquÃ­.</p>
                </div>
            </h:panelGroup>

            <!-- Tabla de movimientos -->
            <h:dataTable value="#{historialTransaccionesBean.movimientos}"
                         var="m"
                         rendered="#{not empty historialTransaccionesBean.movimientos}"
                         styleClass="table movimientos-table">

                <h:column>
                    <f:facet name="header">Fecha</f:facet>
                    <!-- Usamos el String formateado desde la entidad -->
                    <h:outputText value="#{m.fechaFormateada}" />
                </h:column>

                <h:column>
                    <f:facet name="header">Tipo</f:facet>
                    <h:outputText value="#{m.tipoMovimiento}"/>
                </h:column>

                <h:column>
                    <f:facet name="header">Monto</f:facet>
                    <span style="#{m.signo == 1 ? 'color:#4caf50;' : 'color:#ff5252;'}">
                        <h:outputText value="#{m.signo == 1 ? '+' : '-'} S/ "/>
                        <h:outputText value="#{m.monto}">
                            <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>
                        </h:outputText>
                    </span>
                </h:column>

                <h:column>
                    <f:facet name="header">MÃ©todo</f:facet>
                    <h:outputText value="#{m.metodoPago}"/>
                </h:column>

                <h:column>
                    <f:facet name="header">CÃ³digo</f:facet>
                    <h:outputText value="#{m.codigoMovimiento}"/>
                </h:column>

                <h:column>
                    <f:facet name="header">DescripciÃ³n</f:facet>
                    <h:outputText value="#{m.descripcion}"/>
                </h:column>

            </h:dataTable>

        </h:form>

    </div>
</main>

<footer class="footer">
    Â© 2025 INKALOTO â€” Historial de movimientos.
</footer>

<style>
    .info-box {
        max-width: 420px;
        margin: 0 auto 20px auto;
        padding: 12px 18px;
        border-radius: 12px;
        background: #1f1f24;
        color: #f5f5f5;
        font-size: 0.9rem;
        line-height: 1.5;
    }
    .movimientos-table th,
    .movimientos-table td {
        vertical-align: middle;
    }
</style>

<script src="jsp/comprobante.js" type="text/javascript"></script>
</h:body>
</html>
