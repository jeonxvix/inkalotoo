<?xml version="1.0" encoding="UTF-8"?>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/JSP_Servlet/XHtml.xhtml to edit this template
-->
<!DOCTYPE html>
<html lang="es"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">


<h:head>
    <title>Cargar saldo</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link href="css/style.css" rel="stylesheet" type="text/css"/>
</h:head>

<h:body>

<header class="topbar">
    <div class="container nav-slim">
        <!-- Logo / inicio -->
        <a href="#{request.contextPath}/index.xhtml" class="brand">INKALOTO</a>

        <div class="nav-slim-right">
            <!-- ðŸ”” ahora puedes usar el total de no leÃ­das en ESTA pÃ¡gina -->
            <a href="#{request.contextPath}/notificaciones.xhtml"
                class="notif-icon"
                title="Notificaciones">
                 ðŸ””
                 <span id="notifCount" class="notif-badge">
                     #{notificacionesBean.cantidadNoLeidas}
                 </span>
             </a>

            <!-- Cargar saldo -->
            <a href="#{request.contextPath}/cargarsaldo.xhtml" class="btn btn-dark pill">+ Cargar saldo</a>

            <!-- Saldo (si quieres usarlo con miCuentaBean) -->
            <span class="balance-mini">
                S/ <strong>#{miCuentaBean.billetera.saldoActual}</strong>
            </span>

            <!-- MenÃº de usuario -->
            <div class="select user-select">
                <select id="userMenu" onchange="cambiarPagina(this)">
                    <option value="">
                        #{loginBean.usuarioLogueado != null ? loginBean.usuarioLogueado.nombres : 'Usuario'}
                    </option>
                    <option value="#{request.contextPath}/micuenta.xhtml">Mi cuenta</option>
                    <option value="#{request.contextPath}/historialtransacciones.xhtml">Movimientos</option>
                    <option value="#{request.contextPath}/historialjugada.xhtml">Historial de jugadas</option>
                    <option value="#{request.contextPath}/historialpremios.xhtml">Premios</option>
                    <option value="#{request.contextPath}/notificaciones.xhtml">Notificaciones</option>
                    <option value="#{request.contextPath}/retiro.xhtml">Retirar premios</option>
                </select>
            </div>
                                    <!-- Cerrar sesiÃ³n -->
                                    <h:form style="display:inline;">
                    <h:commandButton value="Cerrar sesiÃ³n"
                                     action="#{loginBean.logout}"
                                     styleClass="btn-logout" />
                </h:form>
        </div>
    </div>
</header>

<script>
    function cambiarPagina(select) {
        if (select.value) {
            window.location.href = select.value;
        }
    }
</script>


<main class="panel">
    <div class="panel-inner">

        <h1>Cargar <span class="accent">saldo</span></h1>
        <p class="hint">Selecciona un mÃ©todo de pago, ingresa el monto y confirma la recarga.</p>

        <!-- FORMULARIO JSF REAL -->
        <h:form id="formRecarga" styleClass="form">

            <div class="grid g-2">
                <div class="field">
                    <label>Monto a recargar (S/)</label>
                    <h:inputText id="monto" value="#{cargarSaldoBean.monto}"
                                 required="true" requiredMessage="Ingresa un monto"
                                 type="number" step="0.10" min="1"/>
                </div>

                <div class="field">
                    <label>MÃ©todo de pago</label>
                    <div class="select">
                        <h:selectOneMenu id="metodo"
                                         value="#{cargarSaldoBean.metodo}"
                                         required="true"
                                         onchange="mostrarCamposMetodo()">
                            <f:selectItem itemLabel="Selecciona" itemValue=""/>
                            <f:selectItem itemLabel="Tarjeta (Visa/Mastercard)" itemValue="TARJETA"/>
                            <f:selectItem itemLabel="Yape / Plin" itemValue="YAPE"/>
                            <f:selectItem itemLabel="Transferencia bancaria" itemValue="TRANSFERENCIA"/>
                        </h:selectOneMenu>
                    </div>
                </div>
            </div>

            <!-- CAMPOS QUE CAMBIAN SEGÃšN EL MÃ‰TODO -->
            <div id="camposMetodo" class="grid g-2" style="display:none"></div>

            <!-- COMISIÃ“N Y TOTAL -->
            <div class="grid g-2">
                <div class="field">
                    <label>ComisiÃ³n</label>
                    <input id="comision" type="text" value="S/ 0.00" disabled="disabled"/>
                </div>

                <div class="field">
                    <label>Total a pagar</label>
                    <input id="totalPagar" type="text" value="S/ 0.00" disabled="disabled"/>
                </div>
            </div>

            <!-- BOTÃ“N -->
            <div class="actions-row">
                <h:commandButton value="Confirmar recarga"
                                 styleClass="btn-gold-lg"
                                 action="#{cargarSaldoBean.confirmarRecarga()}"/>
            </div>

            <!-- MENSAJES -->
            <h:panelGroup rendered="#{not empty cargarSaldoBean.mensajeError}">
                <p style="color:red; font-weight:bold;">
                    #{cargarSaldoBean.mensajeError}
                </p>
            </h:panelGroup>

            <h:panelGroup rendered="#{not empty cargarSaldoBean.mensajeExito}">
                <p style="color:green; font-weight:bold;">
                    #{cargarSaldoBean.mensajeExito}
                </p>
            </h:panelGroup>

        </h:form>

        <div id="msgRecarga"></div>

    </div>
</main>

<footer class="footer">
    Â© 2025 INKALOTO â€” Cargar saldo.
</footer>

<!-- ===========================
     JS PARA CAMPOS Y CÃLCULOS
============================ -->
<script>
function mostrarCamposMetodo() {
    const metodo = document.getElementById("formRecarga:metodo").value;
    const contenedor = document.getElementById("camposMetodo");

    contenedor.style.display = "block";

    if (metodo === "TARJETA") {
        contenedor.innerHTML = `
            <div class="field">
                <label>NÃºmero de tarjeta</label>
                <input type="text" placeholder="4111 1111 1111 1111"/>
            </div>

            <div class="field">
                <label>CVV</label>
                <input type="text" placeholder="123"/>
            </div>

            <div class="field">
                <label>Fecha de expiraciÃ³n</label>
                <input type="month"/>
            </div>
        `;
    } else if (metodo === "YAPE") {
        contenedor.innerHTML = `
            <div class="field">
                <label>NÃºmero Yape/Plin</label>
                <input type="text" placeholder="900 000 000"/>
            </div>
        `;
    } else if (metodo === "TRANSFERENCIA") {
        contenedor.innerHTML = `
            <div class="field">
                <label>NÃºmero de operaciÃ³n bancaria</label>
                <input type="text" placeholder="Ej. 123456789"/>
            </div>
        `;
    }

    calcularTotales();
}

function calcularTotales() {
    const montoInput = document.getElementById("formRecarga:monto");
    if (!montoInput) return;

    const monto = parseFloat(montoInput.value || 0);
    const metodo = document.getElementById("formRecarga:metodo").value;

    let comision = 0;

    if (metodo === "TARJETA") comision = monto * 0.05;
    if (metodo === "YAPE") comision = 0;
    if (metodo === "TRANSFERENCIA") comision = 1.50;

    const total = monto + comision;

    document.getElementById("comision").value =
        "S/ " + comision.toFixed(2);

    document.getElementById("totalPagar").value =
        "S/ " + total.toFixed(2);
}

document.getElementById("formRecarga:monto")
    ?.addEventListener("input", calcularTotales);
</script>

</h:body>
</html>
