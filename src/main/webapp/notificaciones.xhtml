<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="es"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <title>INKALOTO - Notificaciones</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link href="css/style.css" rel="stylesheet" type="text/css"/>
</h:head>

<h:body>

<!-- =============== TOPBAR =============== -->
<header class="topbar">
    <div class="container nav-slim">

        <a href="#{request.contextPath}/index.xhtml" class="brand">INKALOTO</a>

        <div class="nav-slim-right">

            <!-- ðŸ”” ahora puedes usar el total de no leÃ­das en ESTA pÃ¡gina -->
            <a href="#{request.contextPath}/notificaciones.xhtml" class="notif-icon" title="Notificaciones">
                ðŸ””
                <h:panelGroup rendered="#{notificacionesBean.cantidadNoLeidas > 0}">
                    <span id="notifCount" class="notif-badge">
                        <h:outputText value="#{notificacionesBean.cantidadNoLeidas}" />
                    </span>
                </h:panelGroup>
            </a>

            <a href="#{request.contextPath}/cargarsaldo.xhtml" class="btn btn-dark pill">+ Cargar saldo</a>

            <span class="balance-mini">
                S/
                <strong>
                    <h:outputText value="#{miCuentaBean.billetera.saldoActual}">
                        <f:convertNumber minFractionDigits="2" maxFractionDigits="2"/>
                    </h:outputText>
                </strong>
            </span>

            <div class="select user-select">
                <select id="userMenu" onchange="cambiarPagina(this)">
                    <option value="">
                        #{loginBean.usuarioLogueado != null ? loginBean.usuarioLogueado.nombres : 'Usuario'}
                    </option>
                    <option value="#{request.contextPath}/micuenta.xhtml">Mi cuenta</option>
                    <option value="#{request.contextPath}/historialtransacciones.xhtml">Movimientos</option>
                    <option value="#{request.contextPath}/historialjugada.xhtml">Historial de jugadas</option>
                    <option value="#{request.contextPath}/historialpremios.xhtml">Premios</option>
                    <option value="#{request.contextPath}/notificaciones.xhtml">Notificaciones</option>
                    <option value="#{request.contextPath}/retiro.xhtml">Retirar premios</option>
                </select>
            </div>
                                    <!-- Cerrar sesiÃ³n -->
                                    <h:form style="display:inline;">
                    <h:commandButton value="Cerrar sesiÃ³n"
                                     action="#{loginBean.logout}"
                                     styleClass="btn-logout" />
                </h:form>
        </div>
    </div>
</header>


<!-- =============== CONTENIDO =============== -->
<main class="panel">
    <div class="panel-inner">

        <h1>Centro de <span class="accent">notificaciones</span></h1>
        <p class="hint">
            AquÃ­ verÃ¡s los avisos de premios, retiros y mensajes importantes de INKALOTO.
        </p>

        <h:form>

            <!-- Si no hay notificaciones -->
            <h:panelGroup rendered="#{empty notificacionesBean.notificaciones}">
                <div style="text-align:center; padding:40px; color:#777;">
                    <h3>No tienes notificaciones</h3>
                    <p>Cuando tengas premios o movimientos importantes, aparecerÃ¡n aquÃ­.</p>
                </div>
            </h:panelGroup>

            <!-- Lista de notificaciones -->
            <h:dataTable value="#{notificacionesBean.notificaciones}"
                         var="n"
                         rendered="#{not empty notificacionesBean.notificaciones}"
                         styleClass="table">

                <h:column>
                    <f:facet name="header">Fecha</f:facet>
                    <h:outputText value="#{n.fechaNotificacion}">
                        <f:convertDateTime type="localDateTime"
                                           pattern="dd/MM/yyyy HH:mm"/>
                    </h:outputText>
                </h:column>

                <h:column>
                    <f:facet name="header">TÃ­tulo</f:facet>
                    <strong>
                        <h:outputText value="#{n.titulo}"/>
                    </strong>
                </h:column>

                <h:column>
                    <f:facet name="header">Mensaje</f:facet>
                    <h:outputText value="#{n.mensaje}"/>
                    <h:panelGroup rendered="#{n.codigoJugada != null}">
                        <br/>
                        <span style="font-size:0.8rem; color:#aaa;">
                            CÃ³digo jugada: #{n.codigoJugada}
                        </span>
                    </h:panelGroup>
                </h:column>

                <h:column>
                    <f:facet name="header">Estado</f:facet>
                    <h:outputText value="#{n.leido ? 'LeÃ­do' : 'No leÃ­do'}"/>
                </h:column>

                <h:column>
                    <f:facet name="header">Acciones</f:facet>

                    <h:commandLink value="Marcar como leÃ­do"
               rendered="#{!n.leido}"
               action="#{notificacionesBean.marcarLeida(n.idNotificacion)}"
               styleClass="button-link"/>

                    <h:panelGroup rendered="#{!n.leido}">
                        &nbsp;|&nbsp;
                    </h:panelGroup>

                    <h:commandLink value="Eliminar"
               action="#{notificacionesBean.eliminar(n.idNotificacion)}"
               styleClass="button-link"/>
                </h:column>

            </h:dataTable>

        </h:form>

    </div>
</main>

<footer class="footer">
    Â© 2025 INKALOTO â€” Notificaciones.
</footer>

<style>
    .table td, .table th {
        vertical-align: top;
    }
</style>
<script src="jsp/comprobante.js" type="text/javascript"></script>
</h:body>
</html>
